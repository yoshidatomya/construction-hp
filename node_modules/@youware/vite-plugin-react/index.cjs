"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const f=require("path"),x=require("module"),E=require("@babel/parser"),S=require("@babel/types"),m=require("fs");var p=typeof document!="undefined"?document.currentScript:null;function w(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>e[r]})}}return t.default=e,Object.freeze(t)}const n=w(S),j={sourceType:"module",allowImportExportEverywhere:!0,ranges:!0,tokens:!0,plugins:["jsx","typescript"]};function h(e,t){const r=f.relative(process.cwd(),t),i=e.loc,a=i?`${i.start.line}:${i.start.column}`:"unknown",s=`${r}@${a}`;return Buffer.from(s,"utf8").toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}const y=x.createRequire(typeof document=="undefined"?require("url").pathToFileURL(__filename).href:p&&p.tagName.toUpperCase()==="SCRIPT"&&p.src||new URL("index.cjs",document.baseURI).href),v=y("@babel/traverse").default,_=y("@babel/generator").default;function I(e){const t=e.children;if(t.length!==1)return!1;const r=t[0];return n.isJSXText(r)?r.value.trim().length>0:!1}function A(e){return!n.isJSXIdentifier(e.openingElement.name)||e.openingElement.name.name.toLowerCase()!=="img"?!1:!!e.openingElement.attributes.find(i=>n.isJSXAttribute(i)&&n.isJSXIdentifier(i.name)&&i.name.name==="src"&&n.isStringLiteral(i.value))}function J(e){const t=e.openingElement.attributes.find(r=>n.isJSXAttribute(r)&&n.isJSXIdentifier(r.name)&&r.name.name==="style");if(!t)return!0;if(n.isJSXAttribute(t)&&n.isJSXExpressionContainer(t.value)){const r=t.value.expression;return n.isObjectExpression(r)?r.properties.every(i=>{if(n.isObjectProperty(i)){const a=n.isIdentifier(i.key)||n.isStringLiteral(i.key),s=n.isStringLiteral(i.value)||n.isNumericLiteral(i.value);return a&&s}return!1}):!1}return!1}function X(e){return!n.isJSXIdentifier(e.openingElement.name)||e.openingElement.name.name.toLowerCase()!=="a"?!1:!!e.openingElement.attributes.find(i=>n.isJSXAttribute(i)&&n.isJSXIdentifier(i.name)&&i.name.name==="href"&&n.isStringLiteral(i.value))}const C=new Set(["html","base","head","link","meta","style","title","body","address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","search","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","menu","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","area","audio","img","map","track","video","embed","iframe","object","param","picture","portal","source","svg","math","canvas","noscript","script","del","ins","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","button","datalist","fieldset","form","input","label","legend","meter","optgroup","option","output","progress","select","textarea","details","dialog","summary","slot","template"]);function T(e){const t=e.openingElement.name;if(n.isJSXMemberExpression(t)||n.isJSXNamespacedName(t)||!n.isJSXIdentifier(t))return!1;const r=t.name;return r[0]===r[0].toUpperCase()?!1:C.has(r)}function L(e){return e.children.some(t=>n.isJSXText(t)&&t.value.trim().length>0)}function P(e,t){e.children=e.children.map(r=>{if(n.isJSXText(r)&&r.value.trim()){const a=h(r,t);return n.jsxElement(n.jsxOpeningElement(n.jsxIdentifier("span"),[n.jsxAttribute(n.jsxIdentifier("data-yw"),n.stringLiteral(a)),n.jsxAttribute(n.jsxIdentifier("data-yw-t"),null),n.jsxAttribute(n.jsxIdentifier("data-yw-auto"),null)],!1),n.jsxClosingElement(n.jsxIdentifier("span")),[n.jsxText(r.value)],!1)}return r})}function O(e,t,r){const i=e.openingElement.attributes;i.push(n.jsxAttribute(n.jsxIdentifier("data-yw"),n.stringLiteral(t))),I(e)?i.push(n.jsxAttribute(n.jsxIdentifier("data-yw-t"),null)):L(e)&&P(e,r),A(e)&&i.push(n.jsxAttribute(n.jsxIdentifier("data-yw-i"),null)),J(e)&&i.push(n.jsxAttribute(n.jsxIdentifier("data-yw-s"),null)),X(e)&&i.push(n.jsxAttribute(n.jsxIdentifier("data-yw-l"),null))}function k(e,t){try{const r=E.parse(e,j);let i=!1;if(v(r,{JSXElement(a){const s=a.node;if(!T(s)||s.openingElement.attributes.some(l=>n.isJSXAttribute(l)&&n.isJSXIdentifier(l.name)&&l.name.name==="data-yw-auto"))return;const c=h(s,t);O(s,c,t),i=!0}}),i){const a=_(r,{retainLines:!0,compact:!1});return{code:a.code,map:a.map}}return null}catch(r){return console.warn(`Error processing JSX elements in file ${t}:`,r),null}}const N=(e,t)=>{const r=f.basename(e);return t.some(i=>r===i)},R=()=>`;
// Visual Editor HMR Bridge - Auto-injected
if (import.meta.hot) {
  import.meta.hot.on('vite:beforeUpdate', (payload) => {
    if (window.__visualEditorCommunication) {
      window.__visualEditorCommunication.handleViteBeforeUpdate(payload);
    }
  });
  
  import.meta.hot.on('vite:afterUpdate', (payload) => {
    if (window.__visualEditorCommunication) {
      window.__visualEditorCommunication.handleViteAfterUpdate(payload);
    }
  });
}
`,b=e=>{let t=e.replace(/\*\*/g,"___DOUBLESTAR___");return t=t.replace(/[.+^${}()|[\]\\]/g,"\\$&"),t=t.replace(/\*/g,"[^/]*"),t=t.replace(/___DOUBLESTAR___/g,".*"),new RegExp(`^${t}$`)},M=(e,t,r)=>r.some(s=>b(s).test(e))?!1:t.some(s=>b(s).test(e));function U(e={}){const{include:t=["**/*.tsx","**/*.jsx"],exclude:r=["node_modules/**","**/dist/**"],entryFiles:i=["main.tsx","main.ts","main.jsx","main.js"]}=e;return{name:"visual-editor-plugin",enforce:"pre",transform(a,s){const u=N(s,i),c=s.endsWith(".tsx")||s.endsWith(".jsx");if(!u&&!c||!(u||M(s,t,r)))return null;try{let o=a,g=null;if(!u||c){const d=k(a,s);d&&(o=d.code,g=d.map)}return u&&(o+=R()),o!==a?{code:o,map:g}:null}catch(o){return console.warn(`Error processing file ${s}:`,o),null}}}}function $(){return{name:"youware-manifest",buildStart(){try{const e=f.resolve(process.cwd(),"yw_manifest.json"),t=f.resolve(process.cwd(),"public","yw_manifest.json");m.existsSync(e)&&(m.mkdirSync(f.dirname(t),{recursive:!0}),m.copyFileSync(e,t))}catch(e){console.error("‚ùå [Youware Manifest] Copy yw_manifest.json failed:",e)}}}}function q(e={}){const{enableReactVisualEditor:t=!!process.env.YOUWARE_SANDBOX,enableCopyManifest:r=!0}=e,i=[];return r&&i.push($()),t&&i.push(U(e.reactVisualEditorOptions)),{name:"youware-vite-plugin",enforce:"pre",buildStart(a){for(const s of i)s.buildStart&&typeof s.buildStart=="function"&&s.buildStart.call(this,a)},transform(a,s){let u=a,c=null;for(const l of i)if(l.transform&&typeof l.transform=="function"){const o=l.transform.call(this,u,s);o&&(typeof o=="string"?u=o:o&&typeof o=="object"&&"code"in o&&o.code&&(u=o.code,"map"in o&&(c=o.map)))}return u!==a?{code:u,map:c}:null}}}exports.youwareVitePlugin=q;
